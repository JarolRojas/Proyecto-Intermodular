CREATE DATABASE VOLUNTARIADO
GO

USE VOLUNTARIADO
GO

CREATE TABLE ORGANIZACION(
    CODORG SMALLINT IDENTITY(1,1) NOT NULL,
    NOMBRE NVARCHAR(50) NOT NULL,
    TIPO_ORG NVARCHAR(25) NOT NULL,
    CORREO NVARCHAR(50) NOT NULL,
    TELEFONO CHAR(9) NOT NULL,
    SECTOR NVARCHAR(20) NOT NULL,
    AMBITO NVARCHAR(20) NOT NULL,
    DESCRIPCION NVARCHAR(500),

    -- CONSTRAINTS
    CONSTRAINT PK_ORGANIZACION PRIMARY KEY (CODORG),
    CONSTRAINT UQ_ORGANIZACION_CORREO UNIQUE (CORREO),
    CONSTRAINT UQ_ORGANIZACION_TELEFONO UNIQUE (TELEFONO),
    CONSTRAINT CK_ORGANIZACION_TIPO_ORG CHECK(TIPO_ORG IN ('ONG', 'FUNDACION', 'ASOCIACION', 'ENTIDAD PÚBLICA', 'OTRA')),
    CONSTRAINT CK_ORGANIZACION_SECTOR CHECK(SECTOR IN ('SOCIAL', 'SALUD', 'EDUCATIVO', 'AMBIENTAL', 'CULTURAL', 'DEPORTIVO', 'TECNOLÓGICO', 'OTRO')),
    CONSTRAINT CK_ORGANIZACION_AMBITO CHECK(AMBITO IN ('LOCAL', 'REGIONAL', 'NACIONAL', 'INTERNACIONAL')),
    CONSTRAINT CK_ORGANIZACION_TELEFONO CHECK(TELEFONO LIKE '[6-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'),
    CONSTRAINT CK_ORGANIZACION_CORREO CHECK(CORREO LIKE '%@%.%')
)
GO

CREATE INDEX IX_ORGANIZACION_NOMBRE ON ORGANIZACION(NOMBRE)
GO


CREATE TABLE ACTIVIDAD(
    CODACT SMALLINT IDENTITY(1,1) NOT NULL,
    NOMBRE NVARCHAR(70) NOT NULL,
    DURACION_SESION TIME NOT NULL,
    FECHA_INICIO DATE NOT NULL,
    FECHA_FIN DATE NOT NULL,
    N_MAX_VOLUNTARIOS SMALLINT NOT NULL,
    CODORG SMALLINT NOT NULL,
    DESCRIPCION NVARCHAR(500) NOT NULL,

    -- CONSTRAINTS
    CONSTRAINT PK_ACTIVIDAD PRIMARY KEY (CODACT),
    CONSTRAINT UQ_ACTIVIDAD_NOMBRE UNIQUE (NOMBRE),
    CONSTRAINT FK_ACTIVIDAD_ORGANIZACION FOREIGN KEY (CODORG) REFERENCES ORGANIZACION(CODORG),
    CONSTRAINT CK_ACTIVIDAD_FECHAS CHECK(FECHA_FIN >= FECHA_INICIO),
    CONSTRAINT CK_ACTIVIDAD_MAX_VOLUNTARIOS CHECK(N_MAX_VOLUNTARIOS > 0)
)
GO

CREATE INDEX IX_ACTIVIDAD_CODORG ON ACTIVIDAD(CODORG)
GO


CREATE TABLE ODS(
    NUMODS SMALLINT NOT NULL,
    DESCRIPCION NVARCHAR(70) NOT NULL,
    CONSTRAINT PK_ODS PRIMARY KEY (NUMODS)
)
GO


CREATE TABLE TIPO_ACTIVIDAD(
    CODTIPO SMALLINT IDENTITY(1,1) NOT NULL,
    DESCRIPCION NVARCHAR(20) NOT NULL,
    CONSTRAINT PK_TIPO_ACTIVIDAD PRIMARY KEY (CODTIPO)
)
GO


CREATE TABLE CICLO(
    CODCICLO NVARCHAR(10) NOT NULL,
    NOMBRE NVARCHAR(70) NOT NULL,
    CURSO SMALLINT NOT NULL,

    -- CONSTRAINTS
    CONSTRAINT PK_CICLO PRIMARY KEY (CODCICLO),
    CONSTRAINT CK_CICLO_CURSO CHECK(CURSO > 0)
)
GO

CREATE INDEX IX_CICLO_NOMBRE_CURSO ON CICLO(NOMBRE, CURSO)
GO


CREATE TABLE VOLUNTARIO(
    CODVOL SMALLINT IDENTITY(1,1) NOT NULL,
    NOMBRE NVARCHAR(30) NOT NULL,
    APELLIDO1 NVARCHAR(30) NOT NULL,
    APELLIDO2 NVARCHAR(30),
    CORREO NVARCHAR(50) NOT NULL,
    TELEFONO CHAR(9) NOT NULL,
    FECHA_NACIMIENTO DATE NOT NULL,
    DESCRIPCION NVARCHAR(500),
    CODCICLO NVARCHAR(10) NOT NULL,

    -- CONSTRAINT
    CONSTRAINT PK_VOLUNTARIO PRIMARY KEY (CODVOL),
    CONSTRAINT UQ_VOLUNTARIO_CORREO UNIQUE (CORREO),
    CONSTRAINT FK_VOLUNTARIO_CICLO FOREIGN KEY (CODCICLO) REFERENCES CICLO(CODCICLO),
    CONSTRAINT CK_VOLUNTARIO_FECHA_NACIMIENTO CHECK(FECHA_NACIMIENTO <= GETDATE()),
    CONSTRAINT CK_VOLUNTARIO_TELEFONO CHECK(TELEFONO LIKE '[6-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'),
    CONSTRAINT CK_VOLUNTARIO_CORREO CHECK(CORREO LIKE '%@%.%')
)
GO

CREATE INDEX IX_VOLUNTARIO_CICLO_NOMBRE ON VOLUNTARIO(CODCICLO, NOMBRE, APELLIDO1, APELLIDO2)
GO


CREATE TABLE DISPONIBILIDAD(
    CODVOL SMALLINT NOT NULL,
    DIA NVARCHAR(10) NOT NULL,
    HORA_SLOT NVARCHAR(10) NOT NULL,

    -- CONSTRAINTS
    CONSTRAINT PK_DISPONIBILIDAD PRIMARY KEY (CODVOL, DIA, HORA_SLOT),
    CONSTRAINT FK_DISPONIBILIDAD_VOLUNTARIO FOREIGN KEY (CODVOL) REFERENCES VOLUNTARIO(CODVOL),
    CONSTRAINT CK_DISPONIBILIDAD_DIA CHECK(DIA IN ('LUNES','MARTES','MIÉRCOLES','JUEVES','VIERNES','SÁBADO','DOMINGO')),
    CONSTRAINT CK_DISPONIBILIDAD_HORA_SLOT CHECK(HORA_SLOT IN ('3-4', '4-5', '5-6', '6-7', '7-8', '8-9', '9-10'))
)
GO


CREATE TABLE ACT_ASOCIADO_TACT(
    CODACT SMALLINT NOT NULL,
    CODTIPO SMALLINT NOT NULL,

    -- CONSTRAINTS
    CONSTRAINT PK_ACT_ASOCIADO_TACT PRIMARY KEY (CODACT, CODTIPO),
    CONSTRAINT FK_ACT_ASOCIADO_TACT_ACTIVIDAD FOREIGN KEY (CODACT) REFERENCES ACTIVIDAD(CODACT),
    CONSTRAINT FK_ACT_ASOCIADO_TACT_TIPO FOREIGN KEY (CODTIPO) REFERENCES TIPO_ACTIVIDAD(CODTIPO)
)
GO


CREATE TABLE VOL_PARTICIPA_ACT(
    CODVOL SMALLINT NOT NULL,
    CODACT SMALLINT NOT NULL,

    -- CONSTRAINTS
    CONSTRAINT PK_VOL_PARTICIPA_ACT PRIMARY KEY (CODVOL, CODACT),
    CONSTRAINT FK_VOL_PARTICIPA_ACT_VOLUNTARIO FOREIGN KEY (CODVOL) REFERENCES VOLUNTARIO(CODVOL),
    CONSTRAINT FK_VOL_PARTICIPA_ACT_ACTIVIDAD FOREIGN KEY (CODACT) REFERENCES ACTIVIDAD(CODACT)
)
GO


CREATE TABLE VOL_PREFIERE_TACT(
    CODVOL SMALLINT NOT NULL,
    CODTIPO SMALLINT NOT NULL,

    -- CONSTRAINTS
    CONSTRAINT PK_VOL_PREFIERE_TACT PRIMARY KEY (CODVOL, CODTIPO),
    CONSTRAINT FK_VOL_PREFIERE_TACT_VOLUNTARIO FOREIGN KEY (CODVOL) REFERENCES VOLUNTARIO(CODVOL),
    CONSTRAINT FK_VOL_PREFIERE_TACT_TIPO FOREIGN KEY (CODTIPO) REFERENCES TIPO_ACTIVIDAD(CODTIPO)
)
GO


CREATE TABLE ACT_PRACTICA_ODS(
    CODACT SMALLINT NOT NULL,
    NUMODS SMALLINT NOT NULL,

    CONSTRAINT PK_ACT_PRACTICA_ODS PRIMARY KEY (CODACT, NUMODS),
    CONSTRAINT FK_ACT_PRACTICA_ODS_ACTIVIDAD FOREIGN KEY (CODACT) REFERENCES ACTIVIDAD(CODACT),
    CONSTRAINT FK_ACT_PRACTICA_ODS_ODS FOREIGN KEY (NUMODS) REFERENCES ODS(NUMODS)
)

--INSERTARD DATOS EN TABLA ORGANIZACION
INSERT INTO ORGANIZACION (NOMBRE, TIPO_ORG, CORREO, TELEFONO, SECTOR, AMBITO, DESCRIPCION)
VALUES
('AMAVIR', 'FUNDACION', 'amavir@example.com', '600000001', 'SALUD', 'LOCAL', 'Organización dedicada a la salud de los mayores.'),
('ANA', 'ONG', 'ana@example.com', '600000002', 'SOCIAL', 'REGIONAL', 'ONG enfocada en la ayuda social.'),
('CUATROVIENTOS', 'ASOCIACION', 'cuatrocientos@example.com', '600000003', 'EDUCATIVO', 'NACIONAL', 'Asociación educativa.'),
('SOLERA', 'ENTIDAD PÚBLICA', 'solera@example.com', '600000004', 'AMBIENTAL', 'INTERNACIONAL', 'Entidad pública ambiental.'),
('UNZUTXIKI', 'OTRA', 'unzutxiki@example.com', '600000005', 'CULTURAL', 'LOCAL', 'Organización cultural local.');

--INSERTARD DATOS EN TABLA CICLO
INSERT INTO CICLO (CODCICLO, NOMBRE, CURSO)
VALUES
('1SC', 'SERVICIOS COMERCIALES', 1),
('2SC', 'SERVICIOS COMERCIALES', 2),
('1AAG', 'AUXILIAR ADMINISTRATIVO GENERAL', 1),
('2AAG', 'AUXILIAR ADMINISTRATIVO GENERAL', 2),
('1GA', 'GESTIÓN ADMINISTRATIVA', 1),
('2GA', 'GESTIÓN ADMINISTRATIVA', 2),
('1AC', 'ACTIVIDADES COMERCIALES', 1),
('2AC', 'ACTIVIDADES COMERCIALES', 2),
('1SMR', 'SISTEMAS MICROINFORMÁTICOS Y REDES', 1),
('2SMR', 'SISTEMAS MICROINFORMÁTICOS Y REDES', 2),
('1AF', 'ADMINISTRACIÓN Y FINANZAS', 1),
('2AF', 'ADMINISTRACIÓN Y FINANZAS', 2),
('1CI', 'COMERCIO INTERNACIONAL', 1),
('2CI', 'COMERCIO INTERNACIONAL', 2),
('1GV', 'GESTIÓN DE VENTAS', 1),
('2GV', 'GESTIÓN DE VENTAS', 2),
('1TL', 'TRANSPORTE Y LOGÍSTICA', 1),
('2TL', 'TRANSPORTE Y LOGÍSTICA', 2),
('1ASIR', 'ADMINISTRACIÓN DE SISTEMAS INFORMÁTICOS Y REDES', 1),
('2ASIR', 'ADMINISTRACIÓN DE SISTEMAS INFORMÁTICOS Y REDES', 2),
('1DAM', 'DESARROLLO DE APLICACIONES MULTIPLATAFORMA', 1),
('2DAM', 'DESARROLLO DE APLICACIONES MULTIPLATAFORMA', 2);

--INSERTARD DATOS EN TABLA VOLUNTARIO
INSERT INTO VOLUNTARIO (NOMBRE, APELLIDO1, APELLIDO2, CORREO, TELEFONO, FECHA_NACIMIENTO, DESCRIPCION, CODCICLO)
VALUES
('Juan', 'Pérez', 'García', 'juan.perez@example.com', '600000006', '1995-05-20', 'Voluntario entusiasta.', '1SMR'),
('María', 'López', 'Sánchez', 'maria.lopez@example.com', '600000007', '1998-07-15', 'Interesada en actividades sociales.', '2DAM'),
('Carlos', 'Gómez', 'Martínez', 'carlos.gomez@example.com', '600000008', '1990-03-10', NULL, '1DAM'),
('Ana', 'Fernández', 'Ruiz', 'ana.fernandez@example.com', '600000009', '2000-01-01', 'Estudiante de marketing.', '1DAM'),
('Luis', 'Martín', 'Hernández', 'luis.martin@example.com', '600000010', '1992-11-25', 'Experiencia en educación.', '2SMR');

--INSERTARD DATOS EN TABLA TIPO_ACTIVIDAD
INSERT INTO TIPO_ACTIVIDAD (DESCRIPCION)
VALUES
('Digital'),
('Salud'),
('Educativo'),
('Ambiental'),
('Deportivo'),
('Social'),
('Cultural'),
('Tecnico');


--INSERTARD DATOS EN TABLA ODS
INSERT INTO ODS (NUMODS, DESCRIPCION)  
VALUES  
(1, 'Fin de la pobreza'),  
(2, 'Hambre cero'),  
(3, 'Salud y bienestar'),  
(4, 'Educación de calidad'),  
(5, 'Igualdad de género'),  
(6, 'Agua limpia y saneamiento'),  
(7, 'Energía asequible y no contaminante'),  
(8, 'Trabajo decente y crecimiento económico'),  
(9, 'Industria, innovación e infraestructura'),  
(10, 'Reducción de las desigualdades'),  
(11, 'Ciudades y comunidades sostenibles'),  
(12, 'Producción y consumo responsables'),  
(13, 'Acción por el clima'),  
(14, 'Vida submarina'),  
(15, 'Vida de ecosistemas terrestres'),  
(16, 'Paz, justicia e instituciones sólidas'),  
(17, 'Alianzas para lograr los objetivos');  

--INSERTARD DATOS EN TABLA ACTIVIDAD
INSERT INTO ACTIVIDAD (NOMBRE, DURACION_SESION, FECHA_INICIO, FECHA_FIN, N_MAX_VOLUNTARIOS, CODORG, DESCRIPCION)
VALUES
('ACTIVIDAD1', '02:00:00', '2023-10-01', '2023-10-02', 10, 1, 'Taller de salud para mayores'),
('ACTIVIDAD2','01:30:00', '2023-11-15', '2023-11-15', 5, 2, 'Reparto de alimentos'),
('ACTIVIDAD3','03:00:00', '2023-12-01', '2023-12-03', 20, 3, 'Jornada educativa'),
('ACTIVIDAD4','01:00:00', '2024-01-10', '2024-01-10', 15, 4, 'Limpieza de playa'),
('ACTIVIDAD5','02:30:00', '2024-02-20', '2024-02-21', 8, 5, 'Festival cultural');


--INSERTARD DATOS EN TABLA DISPONIBILIDAD
INSERT INTO DISPONIBILIDAD (CODVOL, DIA, HORA_SLOT)
VALUES
(1, 'LUNES', '3-4'),
(1, 'MIÉRCOLES', '5-6'),
(2, 'MARTES', '4-5'),
(2, 'JUEVES', '6-7'),
(3, 'VIERNES', '7-8'),
(4, 'SÁBADO', '8-9'),
(5, 'DOMINGO', '9-10');

--INSERTARD DATOS EN TABLA VOL_PARTICIPA_ACT
INSERT INTO VOL_PARTICIPA_ACT (CODVOL, CODACT)
VALUES
(1, 1),  -- Juan participa en Taller de salud
(2, 2),  -- María participa en Reparto de alimentos
(3, 3),  -- Carlos participa en Jornada educativa
(4, 4),  -- Ana participa en Limpieza de playa
(5, 5);  -- Luis participa en Festival cultural

--INSERTARD DATOS EN TABLA VOL_PREFIERE_TACT
INSERT INTO VOL_PREFIERE_TACT (CODVOL, CODTIPO)
VALUES
(1, 1),  -- Juan prefiere Educativa
(2, 2),  -- María prefiere Social
(3, 3),  -- Carlos prefiere Ambiental
(4, 4),  -- Ana prefiere Cultural
(5, 5);  -- Luis prefiere Deportiva


--INSERTARD DATOS EN TABLA ACT_PRACTICA_ODS
INSERT INTO ACT_PRACTICA_ODS (CODACT, NUMODS)
VALUES
(1, 3),  -- Taller de salud (Salud y bienestar)
(2, 2),  -- Reparto de alimentos (Hambre cero)
(3, 4),  -- Jornada educativa (Educación de calidad)
(4, 1),  -- Limpieza de playa (Fin de la pobreza)
(5, 5);  -- Festival cultural (Igualdad de género)

--INSERTARD DATOS EN TABLA ACT_ASOCIADO_TACT
INSERT INTO ACT_ASOCIADO_TACT (CODACT, CODTIPO)
VALUES
(1, 1),  -- Taller de salud (Educativa)
(2, 2),  -- Reparto de alimentos (Social)
(3, 1),  -- Jornada educativa (Educativa)
(4, 3),  -- Limpieza de playa (Ambiental)
(5, 4);  -- Festival cultural (Cultural)

